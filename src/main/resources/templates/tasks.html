<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header(title='Gestion des tâches')}">
    <title>Gestion des tâches</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

<nav th:replace="~{fragments/header :: navbar}"></nav>

<div class="container mt-4">
    <h2>Créer une tâche</h2>
    <form th:action="@{/tasks}" method="post" th:object="${task}" class="mb-4">
        <div class="mb-3">
            <label for="title" class="form-label">Titre</label>
            <input type="text" th:field="*{title}" class="form-control" id="title" required>
        </div>
        <div class="mb-3">
            <label for="assigneeId" class="form-label">ID de l'utilisateur</label>
            <input type="number" th:field="*{assigneeId}" class="form-control" id="assigneeId" required>
        </div>
        <div class="mb-3">
            <label for="projectId" class="form-label">ID du projet</label>
            <input type="number" th:field="*{projectId}" class="form-control" id="projectId" required>
        </div>
        <button type="submit" class="btn btn-primary">Créer</button>
    </form>

    <h2>Liste des tâches</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Titre</th>
            <th>Statut</th>
            <th>Utilisateur</th>
            <th>Projet</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="t : ${tasks}">
            <form th:action="@{'/tasks/edit/' + ${t.id}}" method="post" th:id="|form-${t.id}|">
                <input type="hidden" name="id" th:value="${t.id}" />
                <td th:text="${t.id}"></td>

                <td>
                    <span th:id="|text-title-${t.id}|" th:text="${t.title}"></span>
                    <label>
                        <input type="text" name="title"
                               th:value="${t.title}"
                               class="form-control form-control-sm d-none"
                               th:id="|input-title-${t.id}|" />
                    </label>
                </td>

                <td>
                    <span th:id="|text-status-${t.id}|" th:text="${t.status}"></span>
                    <label>
                        <select name="status" class="form-select form-select-sm d-none"
                                th:id="|select-status-${t.id}|">
                            <option value="TODO" th:selected="${t.status == 'TODO'}">TODO</option>
                            <option value="IN_PROGRESS" th:selected="${t.status == 'IN_PROGRESS'}">IN_PROGRESS</option>
                            <option value="DONE" th:selected="${t.status == 'DONE'}">DONE</option>
                        </select>
                    </label>
                </td>

                <td th:text="${t.assignee}"></td>
                <td th:text="${t.projectId}"></td>

                <td>
                    <div th:id="|actions-${t.id}|">
                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                th:onclick="|toggleEdit(${t.id})|">
                            <i class="bi bi-pencil"></i>
                        </button>
                    </div>

                    <div th:id="|edit-actions-${t.id}|" class="d-none">
                        <button type="submit" class="btn btn-outline-success btn-sm">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-sm"
                                th:onclick="|cancelEdit(${t.id})|">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>
                </td>
            </form>
        </tr>
        </tbody>
    </table>
</div>

<footer th:replace="~{fragments/footer :: footer}"></footer>

<!--suppress JSUnusedGlobalSymbols -->
<script>
    function toggleEdit(id) {
        document.getElementById(`text-title-${id}`).classList.add("d-none");
        document.getElementById(`text-status-${id}`).classList.add("d-none");
        document.getElementById(`input-title-${id}`).classList.remove("d-none");
        document.getElementById(`select-status-${id}`).classList.remove("d-none");

        document.getElementById(`actions-${id}`).classList.add("d-none");
        document.getElementById(`edit-actions-${id}`).classList.remove("d-none");
    }

    function cancelEdit(id) {
        document.getElementById(`text-title-${id}`).classList.remove("d-none");
        document.getElementById(`text-status-${id}`).classList.remove("d-none");
        document.getElementById(`input-title-${id}`).classList.add("d-none");
        document.getElementById(`select-status-${id}`).classList.add("d-none");

        document.getElementById(`actions-${id}`).classList.remove("d-none");
        document.getElementById(`edit-actions-${id}`).classList.add("d-none");
    }
</script>

</body>
</html>
